# Hooky Environment Configuration
# Copy this file to .env and adjust values for your environment

# ============================================================================
# Core Configuration
# ============================================================================

# Environment: development | staging | production
ENVIRONMENT=development

# Rust logging configuration
# Options: trace, debug, info, warn, error
# Format: RUST_LOG=level,module=level
RUST_LOG=info,hooky=debug,sqlx=warn,tower_http=debug

# ============================================================================
# Server Configuration
# ============================================================================

# HTTP server binding
HOST=0.0.0.0
PORT=8080

# Maximum payload size in bytes (10MB default)
MAX_PAYLOAD_SIZE=10485760

# Request timeout in seconds
REQUEST_TIMEOUT=30

# Worker pool configuration
WORKER_POOL_SIZE=100
WORKER_QUEUE_SIZE=10000

# ============================================================================
# Database Configuration
# ============================================================================

# PostgreSQL connection string
DATABASE_URL=postgres://postgres:postgres@localhost:5432/hooky_dev

# Connection pool settings
DATABASE_MAX_CONNECTIONS=100
DATABASE_MIN_CONNECTIONS=10
DATABASE_CONNECTION_TIMEOUT=5
DATABASE_IDLE_TIMEOUT=600
DATABASE_MAX_LIFETIME=1800

# Test database (used by tests and development)
TEST_DATABASE_URL=postgres://postgres:postgres@localhost:5433/hooky_test

# ============================================================================
# TigerBeetle Configuration (Future)
# ============================================================================

# TigerBeetle cluster addresses (comma-separated)
# TIGERBEETLE_ADDRESSES=127.0.0.1:3000
# TIGERBEETLE_CLUSTER_ID=0

# ============================================================================
# Redis Configuration
# ============================================================================

REDIS_URL=redis://localhost:6379
REDIS_MAX_CONNECTIONS=20
REDIS_CONNECTION_TIMEOUT=5

# ============================================================================
# Observability
# ============================================================================

# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_SERVICE_NAME=hooky
OTEL_TRACES_EXPORTER=otlp
OTEL_METRICS_EXPORTER=prometheus
OTEL_RESOURCE_ATTRIBUTES=service.version=0.1.0,deployment.environment=development

# Prometheus metrics endpoint
METRICS_HOST=0.0.0.0
METRICS_PORT=9091
METRICS_PATH=/metrics

# Jaeger tracing (optional, for local development)
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831

# ============================================================================
# Security
# ============================================================================

# JWT signing secret for API tokens (generate with: openssl rand -base64 32)
JWT_SECRET=your-secret-key-here-change-in-production

# API key for internal services
INTERNAL_API_KEY=internal-secret-key-change-in-production

# HMAC secrets for webhook signature validation (per provider)
WEBHOOK_SECRET_STRIPE=whsec_test_stripe_secret
WEBHOOK_SECRET_GITHUB=github_webhook_secret
WEBHOOK_SECRET_SHOPIFY=shopify_webhook_secret
WEBHOOK_SECRET_DEFAULT=default_webhook_secret

# Rate limiting
RATE_LIMIT_PER_SECOND=100
RATE_LIMIT_BURST=1000
RATE_LIMIT_PER_TENANT=1000

# ============================================================================
# Webhook Delivery Configuration
# ============================================================================

# Retry configuration
MAX_RETRY_ATTEMPTS=10
RETRY_BASE_DELAY_MS=1000
RETRY_MAX_DELAY_MS=512000
RETRY_JITTER_FACTOR=0.25

# Circuit breaker
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3
CIRCUIT_BREAKER_TIMEOUT_SECONDS=30

# Delivery timeouts
DELIVERY_TIMEOUT_SECONDS=30
DELIVERY_CONNECTION_TIMEOUT_SECONDS=10

# ============================================================================
# Storage (Optional)
# ============================================================================

# S3/MinIO configuration for large payloads
# S3_ENDPOINT=http://localhost:9000
# S3_ACCESS_KEY=minioadmin
# S3_SECRET_KEY=minioadmin
# S3_BUCKET=webhooks
# S3_REGION=us-east-1

# ============================================================================
# Email Configuration (For notifications)
# ============================================================================

# SMTP settings
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM=noreply@hooky.dev

# ============================================================================
# External Services
# ============================================================================

# Stripe (for billing)
# STRIPE_API_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_...
# STRIPE_PRICE_ID_FREE=price_free
# STRIPE_PRICE_ID_STARTER=price_starter
# STRIPE_PRICE_ID_GROWTH=price_growth
# STRIPE_PRICE_ID_SCALE=price_scale

# ============================================================================
# Development Settings
# ============================================================================

# Enable development features
DEV_MODE=true

# Mock external services
MOCK_EXTERNAL_SERVICES=false

# SQL query logging
LOG_SQL_QUERIES=false

# Pretty print logs (disable in production)
PRETTY_LOGS=true

# Enable debug endpoints
DEBUG_ENDPOINTS=true

# Test mode (disables some validations)
TEST_MODE=false

# Seed database on startup
SEED_DATABASE=false

# ============================================================================
# Feature Flags
# ============================================================================

# Enable TigerBeetle integration
FEATURE_TIGERBEETLE=false

# Enable advanced retry policies
FEATURE_ADVANCED_RETRY=false

# Enable webhook transformations
FEATURE_TRANSFORMATIONS=false

# Enable signed attestations
FEATURE_ATTESTATIONS=false

# ============================================================================
# Migrations
# ============================================================================

# Auto-run migrations on startup
RUN_MIGRATIONS=true

# Migration timeout in seconds
MIGRATION_TIMEOUT=60
